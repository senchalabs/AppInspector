<!DOCTYPE html>
<html>
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <title>The source code</title>
  <link href="../resources/prettify/prettify.css" type="text/css" rel="stylesheet" />
  <script type="text/javascript" src="../resources/prettify/prettify.js"></script>
  <style type="text/css">
    .highlight { display: block; background-color: #ddd; }
  </style>
  <script type="text/javascript">
    function highlight() {
      document.getElementById(location.hash.replace(/#/, "")).className = "highlight";
    }
  </script>
</head>
<body onload="prettyPrint(); highlight();">
  <pre class="prettyprint lang-js">/*

Siesta 2.0.5
Copyright(c) 2009-2013 Bryntum AB
http://bryntum.com/contact
http://bryntum.com/products/siesta/license

*/
<span id='Siesta-Recorder-DragEditor'>/**
</span> * Target editor.
 */
Ext.define('Siesta.Recorder.DragEditor', {
    extend : 'Ext.form.field.Picker',
    alias  : 'widget.drageditor',

<span id='Siesta-Recorder-DragEditor-property-editable'>    editable     : false,
</span><span id='Siesta-Recorder-DragEditor-property-hideTrigger'>    hideTrigger  : true,
</span><span id='Siesta-Recorder-DragEditor-property-pickerOffset'>    pickerOffset : [ 0, -20 ],
</span>
<span id='Siesta-Recorder-DragEditor-property-listeners'>    listeners : {
</span>        focus : function (fld, e, opts) {
            fld.expand();
        }
    },

<span id='Siesta-Recorder-DragEditor-method-cancelEdit'>    cancelEdit : function () {
</span>        var me = this;
        me.fireEvent('blur');
        me.collapse();
    },

<span id='Siesta-Recorder-DragEditor-method-applyValues'>    applyValues : function () {
</span>        var me = this,
            form = me.picker,
            vals = form.getForm().getValues(),
            rec = me.up('gridpanel').editing.activeRecord;

        var prot = Siesta.Recorder.RecordedEvent.prototype;
        var by = vals.by;

        vals.by = (by &amp;&amp; prot.parseOffset(by)) || by;

        rec.set(vals);
        me.fireEvent('blur');
        me.collapse();
    },

<span id='Siesta-Recorder-DragEditor-method-createPicker'>    createPicker : function () {
</span>        var me = this;
        var targetListeners = {
            select : this.onTargetChange,
            keyup  : this.onTargetChange,
            focus  : this.onTargetChange,
            buffer : 50,
            scope  : this
        };

        return new Ext.form.Panel({
            ownerCt     : this,
            renderTo    : document.body,
            floating    : true,
            bodyPadding : 5,
            title       : 'Edit drag action',
            items       : [
                new Siesta.Recorder.TargetEditor({
                    fieldLabel : 'Target:',
                    anchor     : '100%',
                    name       : 'actionTarget',
                    labelWidth : 60,
                    listeners  : targetListeners
                }),
                new Siesta.Recorder.TargetEditor({
                    fieldLabel : 'To:',
                    name       : 'to',
                    anchor     : '100%',
                    labelWidth : 60,

                    listeners  : targetListeners
                }),
                {
                    xtype      : 'textfield',
                    name       : 'by',
                    fieldLabel : 'By:',
                    labelWidth : 60,
                    width      : 200
                }
            ],
            listeners: {
                afterrender: function( panel, opts ) {
                    var rec = panel.up('gridpanel').editing.activeRecord;
                    panel.getForm().setValues(rec.data);
                }
            },
            buttons : [
                {
                    name    : 'cancel',
                    text    : 'Cancel',
                    handler : function (btn, e, opts) {
                        me.cancelEdit();
                    }
                },
                '-&gt;',
                {
                    name    : 'save',
                    text    : 'Save',
                    handler : function (btn, e, opts) {
                        me.applyValues();
                    }
                }
            ]
        });
    }

});
</pre>
</body>
</html>
